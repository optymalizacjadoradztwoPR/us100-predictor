<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <title>US100 & GOLD - 11 WSKA≈πNIK√ìW (poprawione)</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: 'Segoe UI', Arial, sans-serif; 
            background: #0a0f1e; 
            color: #e0e0e0; 
            padding: 20px;
        }
        .container { max-width: 1800px; margin: 0 auto; }
        
        .header { 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
            margin-bottom: 20px; 
            padding: 20px 25px;
            background: #1a2634;
            border-radius: 15px;
            border: 1px solid #2a3744;
        }
        .logo h1 { 
            color: #60a5fa; 
            font-size: 1.8em;
        }
        .instrument-select {
            background: #2a3744;
            color: white;
            border: 1px solid #3b4b5e;
            padding: 12px 25px;
            border-radius: 8px;
            font-size: 1.1em;
            cursor: pointer;
            min-width: 220px;
        }
        .instrument-select option {
            background: #1a2634;
        }
        .time-box { text-align: right; }
        .current-time { 
            font-size: 1.3em; 
            color: #60a5fa; 
            font-weight: bold; 
        }
        .trading-window {
            background: #f59e0b;
            color: black;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.8em;
            font-weight: bold;
            margin-top: 5px;
        }
        .trading-window.active {
            background: #22c55e;
            color: white;
            animation: pulse 1s infinite;
        }
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.7; }
            100% { opacity: 1; }
        }
        
        /* Panel g≈Ç√≥wny - 2 kolumny */
        .main-panel {
            display: grid;
            grid-template-columns: 1fr 2fr;
            gap: 20px;
            margin-bottom: 20px;
        }
        
        /* Panel z≈Çota */
        .gold-panel {
            background: linear-gradient(135deg, #92400e, #78350f);
            border-radius: 15px;
            padding: 20px;
            border: 1px solid #b45309;
        }
        .gold-panel h3 { 
            color: #fbbf24; 
            margin-bottom: 15px; 
            font-size: 1.3em; 
        }
        .gold-price { 
            font-size: 2.5em; 
            font-weight: bold; 
            color: #fbbf24; 
            font-family: monospace; 
        }
        .gold-change { 
            font-size: 1.2em; 
            margin: 10px 0; 
        }
        .gold-change.positive { color: #22c55e; }
        .gold-change.negative { color: #ef4444; }
        .gold-signal {
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            font-weight: bold;
            margin: 15px 0;
            font-size: 1.2em;
        }
        .gold-signal.buy { 
            background: rgba(34, 197, 94, 0.3); 
            border: 1px solid #22c55e; 
            color: #22c55e; 
        }
        .gold-signal.sell { 
            background: rgba(239, 68, 68, 0.3); 
            border: 1px solid #ef4444; 
            color: #ef4444; 
        }
        .gold-indicator-row {
            display: flex;
            justify-content: space-between;
            margin: 5px 0;
            color: #d1d5db;
        }
        
        /* Panel US100 */
        .us100-panel {
            background: linear-gradient(135deg, #1e293b, #0f172a);
            border-radius: 15px;
            padding: 20px;
            border: 1px solid #2a3744;
        }
        .us100-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        .us100-header h3 { 
            color: #60a5fa; 
            font-size: 1.3em; 
        }
        .us100-price { 
            font-size: 3.5em; 
            font-weight: bold; 
            color: white; 
            font-family: monospace; 
        }
        .us100-change { 
            font-size: 1.3em; 
            margin: 10px 0; 
        }
        .us100-change.positive { color: #22c55e; }
        .us100-change.negative { color: #ef4444; }
        .us100-signal {
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            font-weight: bold;
            font-size: 1.5em;
            margin: 15px 0;
        }
        .us100-signal.buy { 
            background: rgba(34, 197, 94, 0.2); 
            border: 2px solid #22c55e; 
            color: #22c55e; 
        }
        .us100-signal.sell { 
            background: rgba(239, 68, 68, 0.2); 
            border: 2px solid #ef4444; 
            color: #ef4444; 
        }
        
        /* TradingView Widget */
        .tradingview-container {
            background: #1a2634;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            border: 1px solid #2a3744;
            height: 1700px;
        }
        #tradingview_widget { 
            height: 100%; 
            width: 100%; 
        }
        
        /* Grid wska≈∫nik√≥w */
        .indicators-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        .indicator-card {
            background: #1a2634;
            border: 1px solid #2a3744;
            border-radius: 10px;
            padding: 15px;
            transition: all 0.2s;
        }
        .indicator-card:hover {
            border-color: #60a5fa;
        }
        .indicator-name {
            color: #9ca3af;
            font-size: 0.9em;
            margin-bottom: 5px;
        }
        .indicator-value {
            color: #60a5fa;
            font-size: 1.4em;
            font-weight: bold;
            font-family: monospace;
        }
        .indicator-badge {
            font-size: 0.8em;
            padding: 2px 8px;
            border-radius: 12px;
            margin-left: 5px;
        }
        .badge-buy { 
            background: rgba(34, 197, 94, 0.2); 
            color: #22c55e; 
            border: 1px solid #22c55e;
        }
        .badge-sell { 
            background: rgba(239, 68, 68, 0.2); 
            color: #ef4444; 
            border: 1px solid #ef4444;
        }
        
        /* Przyczyny */
        .reasons-box {
            background: #1a2634;
            border: 1px solid #2a3744;
            border-radius: 15px;
            padding: 20px;
            margin-top: 20px;
        }
        .reasons-box h3 {
            color: #e0e0e0;
            margin-bottom: 15px;
        }
        .reason {
            color: #d1d5db;
            margin: 8px 0;
            padding: 10px 15px;
            background: #2a3744;
            border-radius: 8px;
            border-left: 4px solid;
        }
        .reason.buy { border-left-color: #22c55e; }
        .reason.sell { border-left-color: #ef4444; }
        
        /* Historia */
        .signal-history {
            background: #1a2634;
            border: 1px solid #2a3744;
            border-radius: 15px;
            padding: 20px;
            margin-top: 20px;
        }
        .history-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 15px;
            margin: 5px 0;
            background: #2a3744;
            border-radius: 8px;
            border-left: 4px solid transparent;
        }
        .history-item.buy { border-left-color: #22c55e; }
        .history-item.sell { border-left-color: #ef4444; }
        .history-time { color: #9ca3af; font-size: 0.9em; }
        .history-price { color: white; font-weight: bold; }
        
        /* Footer */
        .footer {
            margin-top: 20px;
            padding: 20px;
            background: #1a2634;
            border-radius: 15px;
            text-align: center;
            color: #9ca3af;
            border: 1px solid #2a3744;
        }
        .footer span { 
            color: #60a5fa; 
            font-weight: bold; 
        }
        
        @media (max-width: 1200px) {
            .main-panel { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <div class="logo">
                <h1>üìä 11 WSKA≈πNIK√ìW (POPRAWIONE)</h1>
            </div>
            <select id="instrumentSelect" class="instrument-select">
                <option value="NASDAQ:NDX" selected>üìà US100 (g≈Ç√≥wny)</option>
                <option value="TVC:GOLD">üèÜ Z≈ÅOTO</option>
            </select>
            <div class="time-box">
                <div id="currentTime" class="current-time">--:--:--</div>
                <div id="tradingWindow" class="trading-window">‚è≥ POZA OKNEM</div>
            </div>
        </div>

        <!-- Panel g≈Ç√≥wny -->
        <div class="main-panel">
            <!-- Z≈ÅOTO -->
            <div class="gold-panel" id="goldPanel">
                <h3>üèÜ Z≈ÅOTO (XAU/USD)</h3>
                <div id="goldPrice" class="gold-price">---</div>
                <div id="goldChange" class="gold-change"></div>
                <div id="goldSignal" class="gold-signal">‚è≥ ANALIZA...</div>
                <div id="goldVolume" style="color: #d1d5db; margin: 10px 0;">Wolumen: ---</div>
                <div class="gold-indicator-row">
                    <span>RSI:</span> <span id="goldRsi">---</span>
                </div>
                <div class="gold-indicator-row">
                    <span>MACD:</span> <span id="goldMacd">---</span>
                </div>
                <div class="gold-indicator-row">
                    <span>ADX:</span> <span id="goldAdx">---</span>
                </div>
                <div class="gold-indicator-row">
                    <span>MFI:</span> <span id="goldMfi">---</span>
                </div>
            </div>

            <!-- US100 -->
            <div class="us100-panel">
                <div class="us100-header">
                    <h3>üìà US100 (NASDAQ:NDX)</h3>
                    <span id="us100Window" style="color: #f59e0b;"></span>
                </div>
                <div id="us100Price" class="us100-price">---</div>
                <div id="us100Change" class="us100-change"></div>
                <div id="us100Signal" class="us100-signal">‚è≥ ANALIZA 11 WSKA≈πNIK√ìW...</div>
                <div id="us100Volume" style="color: #9ca3af; margin-top: 10px;">Wolumen: ---</div>
            </div>
        </div>

        <!-- TradingView Widget -->
        <div class="tradingview-container">
            <div id="tradingview_widget"></div>
        </div>

        <!-- WSZYSTKIE WSKA≈πNIKI US100 -->
        <div class="indicators-grid">
            <div class="indicator-card">
                <div class="indicator-name">
                    RSI (14) <span id="rsiBadge" class="indicator-badge"></span>
                </div>
                <div class="indicator-value" id="rsiValue">---</div>
            </div>
            <div class="indicator-card">
                <div class="indicator-name">
                    MACD <span id="macdBadge" class="indicator-badge"></span>
                </div>
                <div class="indicator-value" id="macdValue">---</div>
            </div>
            <div class="indicator-card">
                <div class="indicator-name">
                    SMA 20/50 <span id="smaBadge" class="indicator-badge"></span>
                </div>
                <div class="indicator-value" id="smaValue">---</div>
            </div>
            <div class="indicator-card">
                <div class="indicator-name">
                    ADX (14) <span id="adxBadge" class="indicator-badge"></span>
                </div>
                <div class="indicator-value" id="adxValue">---</div>
            </div>
            <div class="indicator-card">
                <div class="indicator-name">
                    Stochastic <span id="stochBadge" class="indicator-badge"></span>
                </div>
                <div class="indicator-value" id="stochValue">---</div>
            </div>
            <div class="indicator-card">
                <div class="indicator-name">
                    CCI (20) <span id="cciBadge" class="indicator-badge"></span>
                </div>
                <div class="indicator-value" id="cciValue">---</div>
            </div>
            <div class="indicator-card">
                <div class="indicator-name">
                    MFI (14) <span id="mfiBadge" class="indicator-badge"></span>
                </div>
                <div class="indicator-value" id="mfiValue">---</div>
            </div>
            <div class="indicator-card">
                <div class="indicator-name">
                    Williams %R <span id="williamsBadge" class="indicator-badge"></span>
                </div>
                <div class="indicator-value" id="williamsValue">---</div>
            </div>
            <div class="indicator-card">
                <div class="indicator-name">
                    ATR (14) <span id="atrBadge" class="indicator-badge"></span>
                </div>
                <div class="indicator-value" id="atrValue">---</div>
            </div>
            <div class="indicator-card">
                <div class="indicator-name">
                    ROC (12) <span id="rocBadge" class="indicator-badge"></span>
                </div>
                <div class="indicator-value" id="rocValue">---</div>
            </div>
            <div class="indicator-card">
                <div class="indicator-name">
                    Wolumen <span id="volumeBadge" class="indicator-badge"></span>
                </div>
                <div class="indicator-value" id="volumeValue">---</div>
            </div>
        </div>

        <!-- Przyczyny -->
        <div id="reasonsBox" class="reasons-box" style="display: none;">
            <h3>üìä ANALIZA 11 WSKA≈πNIK√ìW:</h3>
            <div id="reasonsList"></div>
            <div style="margin-top: 15px; color: #60a5fa;" id="scoreDisplay"></div>
        </div>

        <!-- Historia -->
        <div class="signal-history">
            <h3>üìú HISTORIA SYGNA≈Å√ìW (US100)</h3>
            <div id="signalHistory"></div>
        </div>

        <!-- Footer -->
        <div class="footer">
            <p>‚ö° <span>11 WSKA≈πNIK√ìW - POPRAWIONE KIERUNKI:</span> RSI, MACD, SMA, ADX, Stoch, CCI, MFI, Williams, ATR, ROC, Volume</p>
        </div>
    </div>

    <!-- Scripts -->
    <script type="text/javascript" src="https://s3.tradingview.com/tv.js"></script>
    
    <script>
        // ==================== KONFIGURACJA ====================
        const INSTRUMENTS = {
            'NASDAQ:NDX': { name: 'US100', basePrice: 24738, volume: 45000000 },
            'TVC:GOLD': { name: 'Z≈ÅOTO', basePrice: 2900, volume: 250000 }
        };

        // ==================== STANY ====================
        let priceHistory = [];
        let goldHistory = [];
        let signalHistory = [];
        let lastSignalTime = 0;
        let lastSignal = null;
        let confirmationCount = 0;
        let currentInstrument = 'NASDAQ:NDX';
        
        const REQUIRED_CONFIRMATIONS = 3;
        const MIN_SIGNAL_INTERVAL = 5 * 60 * 1000;

        // ==================== CZAS ====================
        function updateTime() {
            const now = new Date();
            document.getElementById('currentTime').textContent = now.toLocaleTimeString('pl-PL');
            
            const hours = now.getHours();
            const minutes = now.getMinutes();
            const currentMinutes = hours * 60 + minutes;
            
            const window1Start = 15 * 60 + 30;
            const window1End = 16 * 60;
            const window2Start = 16 * 60 + 30;
            const window2End = 17 * 60;
            
            const inWindow1 = currentMinutes >= window1Start && currentMinutes < window1End;
            const inWindow2 = currentMinutes >= window2Start && currentMinutes < window2End;
            const inWindow = inWindow1 || inWindow2;
            
            const windowElement = document.getElementById('tradingWindow');
            
            if (inWindow) {
                let windowText = inWindow1 ? '15:30-16:00' : '16:30-17:00';
                windowElement.textContent = `üü¢ OKNO ${windowText}`;
                windowElement.className = 'trading-window active';
                document.getElementById('us100Window').innerHTML = `‚ö†Ô∏è OKNO ${windowText}`;
            } else {
                windowElement.textContent = '‚è≥ POZA OKNEM';
                windowElement.className = 'trading-window';
                document.getElementById('us100Window').innerHTML = '';
            }
        }
        setInterval(updateTime, 1000);
        updateTime();

        // ==================== TRADINGVIEW ====================
        function initTradingView(symbol) {
            const container = document.getElementById('tradingview_widget');
            container.innerHTML = '';
            
            new TradingView.widget({
                "width": "100%",
                "height": "100%",
                "symbol": symbol,
                "interval": "1",
                "timezone": "Europe/Warsaw",
                "theme": "dark",
                "style": "1",
                "locale": "pl",
                "enable_publishing": false,
                "withdateranges": true,
                "allow_symbol_change": false,
                "details": true,
                "studies": [
                    "RSI@tv-basicstudies",
                    "MACD@tv-basicstudies",
                    "Volume@tv-basicstudies"
                ],
                "container_id": "tradingview_widget"
            });
        }

        // ==================== GENERUJ WSKA≈πNIKI ====================
        function generateIndicators(basePrice, prevPrice) {
            // RSI (0-100) - celowo robiƒô skrajno≈õci dla testu
            const rsi = Math.floor(Math.random() * 100);
            
            // MACD
            const macd = (Math.random() * 40 - 20).toFixed(2);
            const macdSignal = (Math.random() * 40 - 20).toFixed(2);
            
            // SMA
            const sma20 = basePrice * (0.98 + Math.random() * 0.04);
            const sma50 = basePrice * (0.97 + Math.random() * 0.04);
            
            // ADX
            const adx = Math.floor(Math.random() * 50 + 10);
            const pdi = Math.floor(Math.random() * 40 + 10);
            const mdi = Math.floor(Math.random() * 40 + 10);
            
            // Stochastic
            const stochK = Math.floor(Math.random() * 100);
            
            // CCI
            const cci = Math.floor(Math.random() * 300 - 150);
            
            // MFI
            const mfi = Math.floor(Math.random() * 100);
            
            // Williams
            const williams = Math.floor(Math.random() * 100 - 50);
            
            // ATR
            const atr = (Math.random() * 150 + 50).toFixed(2);
            
            // ROC
            const roc = (Math.random() * 20 - 10).toFixed(2);
            
            // Wolumen
            const volume = 30000000 + Math.random() * 20000000;
            
            return {
                rsi, macd, macdSignal, sma20, sma50, adx, pdi, mdi,
                stochK, cci, mfi, williams, atr, roc, volume
            };
        }

        // ==================== ANALIZA WSKA≈πNIK√ìW ====================
        function analyzeAllIndicators(indicators, price, prevPrice) {
            let buyScore = 0;
            let sellScore = 0;
            const reasons = [];
            
            // 1. RSI - PONI≈ªEJ 30 = WYKUPIENIE (BUY), POWY≈ªEJ 70 = WYKUPIENIE (SELL)
            if (indicators.rsi < 30) {
                buyScore += 30;
                reasons.push({ text: `RSI: ${indicators.rsi} (<30) - WYKUPIENIE - SYGNA≈Å KUPNA`, type: 'buy' });
            } else if (indicators.rsi > 70) {
                sellScore += 30;
                reasons.push({ text: `RSI: ${indicators.rsi} (>70) - WYKUPIENIE - SYGNA≈Å SPRZEDA≈ªY`, type: 'sell' });
            }
            
            // 2. MACD - POWY≈ªEJ SYGNA≈ÅOWEJ = BYCZY (BUY), PONI≈ªEJ = NIED≈πWIEDZI (SELL)
            if (parseFloat(indicators.macd) > parseFloat(indicators.macdSignal)) {
                buyScore += 20;
                reasons.push({ text: `MACD: ${indicators.macd} > Sygna≈Çowa - BYCZY (BUY)`, type: 'buy' });
            } else {
                sellScore += 20;
                reasons.push({ text: `MACD: ${indicators.macd} < Sygna≈Çowa - NIED≈πWIEDZI (SELL)`, type: 'sell' });
            }
            
            // 3. SMA 20/50 - SMA20 > SMA50 = TREND WZROSTOWY (BUY)
            if (indicators.sma20 > indicators.sma50) {
                buyScore += 15;
                reasons.push({ text: `SMA20 > SMA50 - TREND WZROSTOWY (BUY)`, type: 'buy' });
            } else {
                sellScore += 15;
                reasons.push({ text: `SMA20 < SMA50 - TREND SPADKOWY (SELL)`, type: 'sell' });
            }
            
            // 4. ADX - PDI > MDI = BYCZY, MDI > PDI = NIED≈πWIEDZI
            if (indicators.adx > 25) {
                if (indicators.pdi > indicators.mdi) {
                    buyScore += 15;
                    reasons.push({ text: `ADX: ${indicators.adx} - SILNY TREND WZROSTOWY (BUY)`, type: 'buy' });
                } else {
                    sellScore += 15;
                    reasons.push({ text: `ADX: ${indicators.adx} - SILNY TREND SPADKOWY (SELL)`, type: 'sell' });
                }
            }
            
            // 5. Stochastic - PONI≈ªEJ 20 = WYKUPIENIE (BUY), POWY≈ªEJ 80 = WYKUPIENIE (SELL)
            if (indicators.stochK < 20) {
                buyScore += 15;
                reasons.push({ text: `Stochastic: ${indicators.stochK} (<20) - WYKUPIENIE (BUY)`, type: 'buy' });
            } else if (indicators.stochK > 80) {
                sellScore += 15;
                reasons.push({ text: `Stochastic: ${indicators.stochK} (>80) - WYKUPIENIE (SELL)`, type: 'sell' });
            }
            
            // 6. CCI - PONI≈ªEJ -100 = WYKUPIENIE (BUY), POWY≈ªEJ 100 = WYKUPIENIE (SELL)
            if (indicators.cci < -100) {
                buyScore += 15;
                reasons.push({ text: `CCI: ${indicators.cci} (<-100) - WYKUPIENIE (BUY)`, type: 'buy' });
            } else if (indicators.cci > 100) {
                sellScore += 15;
                reasons.push({ text: `CCI: ${indicators.cci} (>100) - WYKUPIENIE (SELL)`, type: 'sell' });
            }
            
            // 7. MFI - PONI≈ªEJ 20 = WYKUPIENIE (BUY), POWY≈ªEJ 80 = WYKUPIENIE (SELL)
            if (indicators.mfi < 20) {
                buyScore += 15;
                reasons.push({ text: `MFI: ${indicators.mfi} (<20) - WYKUPIENIE (BUY)`, type: 'buy' });
            } else if (indicators.mfi > 80) {
                sellScore += 15;
                reasons.push({ text: `MFI: ${indicators.mfi} (>80) - WYKUPIENIE (SELL)`, type: 'sell' });
            }
            
            // 8. Williams %R - PONI≈ªEJ -80 = WYKUPIENIE (BUY), POWY≈ªEJ -20 = WYKUPIENIE (SELL)
            if (indicators.williams < -80) {
                buyScore += 10;
                reasons.push({ text: `Williams: ${indicators.williams} (<-80) - WYKUPIENIE (BUY)`, type: 'buy' });
            } else if (indicators.williams > -20) {
                sellScore += 10;
                reasons.push({ text: `Williams: ${indicators.williams} (>-20) - WYKUPIENIE (SELL)`, type: 'sell' });
            }
            
            // 9. ROC - POWY≈ªEJ 2% = SILNY WZROST (BUY), PONI≈ªEJ -2% = SILNY SPADEK (SELL)
            if (parseFloat(indicators.roc) > 2) {
                buyScore += 10;
                reasons.push({ text: `ROC: ${indicators.roc}% (>2%) - SILNY WZROST (BUY)`, type: 'buy' });
            } else if (parseFloat(indicators.roc) < -2) {
                sellScore += 10;
                reasons.push({ text: `ROC: ${indicators.roc}% (<-2%) - SILNY SPADEK (SELL)`, type: 'sell' });
            }
            
            // 10. Wolumen - wysoki + kierunek ceny
            const avgVolume = 35000000;
            if (indicators.volume > avgVolume * 1.2) {
                const priceChange = ((price - prevPrice) / prevPrice) * 100;
                if (priceChange > 0) {
                    buyScore += 15;
                    reasons.push({ text: `Wolumen: WYSOKI + WZROST CENY - POTWIERDZENIE (BUY)`, type: 'buy' });
                } else if (priceChange < 0) {
                    sellScore += 15;
                    reasons.push({ text: `Wolumen: WYSOKI + SPADEK CENY - POTWIERDZENIE (SELL)`, type: 'sell' });
                }
            }
            
            return { buyScore, sellScore, reasons };
        }

        // ==================== G≈Å√ìWNA FUNKCJA ====================
        function calculateIndicators() {
            // Ceny
            const us100Price = INSTRUMENTS['NASDAQ:NDX'].basePrice + (Math.random() - 0.5) * 300;
            const prevUs100Price = priceHistory.length > 0 ? priceHistory[priceHistory.length-1] : us100Price * 0.999;
            
            const goldPrice = INSTRUMENTS['TVC:GOLD'].basePrice + (Math.random() - 0.5) * 30;
            const prevGoldPrice = goldHistory.length > 0 ? goldHistory[goldHistory.length-1] : goldPrice * 0.999;
            
            // Historia
            priceHistory.push(us100Price);
            goldHistory.push(goldPrice);
            if (priceHistory.length > 30) priceHistory.shift();
            if (goldHistory.length > 30) goldHistory.shift();
            
            // Generuj wska≈∫niki
            const us100Ind = generateIndicators(us100Price, prevUs100Price);
            const goldInd = generateIndicators(goldPrice, prevGoldPrice);
            
            // ===== PANEL Z≈ÅOTA =====
            document.getElementById('goldPrice').textContent = goldPrice.toFixed(2);
            document.getElementById('goldVolume').textContent = 'Wolumen: ' + Math.floor(goldInd.volume).toLocaleString();
            
            const goldChange = ((goldPrice - prevGoldPrice) / prevGoldPrice * 100).toFixed(2);
            const goldChangeEl = document.getElementById('goldChange');
            goldChangeEl.textContent = (goldChange > 0 ? '+' : '') + goldChange + '%';
            goldChangeEl.className = 'gold-change ' + (goldChange >= 0 ? 'positive' : 'negative');
            
            document.getElementById('goldRsi').textContent = goldInd.rsi;
            document.getElementById('goldMacd').textContent = goldInd.macd;
            document.getElementById('goldAdx').textContent = goldInd.adx;
            document.getElementById('goldMfi').textContent = goldInd.mfi;
            
            // Analiza z≈Çota
            const goldAnalysis = analyzeAllIndicators(goldInd, goldPrice, prevGoldPrice);
            const goldSignalEl = document.getElementById('goldSignal');
            const goldTotal = goldAnalysis.buyScore - goldAnalysis.sellScore;
            
            if (goldTotal > 40) {
                goldSignalEl.className = 'gold-signal buy';
                goldSignalEl.innerHTML = `üü¢ KUPUJ (${goldTotal} pkt)`;
            } else if (goldTotal < -40) {
                goldSignalEl.className = 'gold-signal sell';
                goldSignalEl.innerHTML = `üî¥ SPRZEDAJ (${goldTotal} pkt)`;
            } else {
                goldSignalEl.className = 'gold-signal';
                goldSignalEl.innerHTML = `‚è≥ NEUTRALNY (${goldAnalysis.buyScore}/${goldAnalysis.sellScore})`;
            }
            
            // ===== PANEL US100 =====
            document.getElementById('us100Price').textContent = us100Price.toFixed(2);
            document.getElementById('us100Volume').textContent = 'Wolumen: ' + Math.floor(us100Ind.volume).toLocaleString();
            
            const us100Change = ((us100Price - prevUs100Price) / prevUs100Price * 100).toFixed(2);
            const us100ChangeEl = document.getElementById('us100Change');
            us100ChangeEl.textContent = (us100Change > 0 ? '+' : '') + us100Change + '%';
            us100ChangeEl.className = 'us100-change ' + (us100Change >= 0 ? 'positive' : 'negative');
            
            // Wype≈Çnij wska≈∫niki
            document.getElementById('rsiValue').textContent = us100Ind.rsi;
            document.getElementById('macdValue').textContent = us100Ind.macd;
            document.getElementById('smaValue').textContent = us100Ind.sma20.toFixed(2);
            document.getElementById('adxValue').textContent = us100Ind.adx;
            document.getElementById('stochValue').textContent = us100Ind.stochK;
            document.getElementById('cciValue').textContent = us100Ind.cci;
            document.getElementById('mfiValue').textContent = us100Ind.mfi;
            document.getElementById('williamsValue').textContent = us100Ind.williams;
            document.getElementById('atrValue').textContent = us100Ind.atr;
            document.getElementById('rocValue').textContent = us100Ind.roc;
            document.getElementById('volumeValue').textContent = Math.floor(us100Ind.volume / 1000000) + 'M';
            
            // Badges - PRAWID≈ÅOWE KIERUNKI
            const setBadge = (id, condition, type) => {
                const badge = document.getElementById(id);
                if (condition) {
                    badge.innerHTML = type === 'buy' ? 'üü¢ BUY' : 'üî¥ SELL';
                    badge.className = 'indicator-badge ' + (type === 'buy' ? 'badge-buy' : 'badge-sell');
                } else {
                    badge.innerHTML = '';
                    badge.className = 'indicator-badge';
                }
            };
            
            setBadge('rsiBadge', us100Ind.rsi < 30, 'buy');
            setBadge('rsiBadge', us100Ind.rsi > 70, 'sell');
            
            setBadge('macdBadge', parseFloat(us100Ind.macd) > parseFloat(us100Ind.macdSignal), 'buy');
            setBadge('macdBadge', parseFloat(us100Ind.macd) < parseFloat(us100Ind.macdSignal), 'sell');
            
            setBadge('smaBadge', us100Ind.sma20 > us100Ind.sma50, 'buy');
            setBadge('smaBadge', us100Ind.sma20 < us100Ind.sma50, 'sell');
            
            setBadge('stochBadge', us100Ind.stochK < 20, 'buy');
            setBadge('stochBadge', us100Ind.stochK > 80, 'sell');
            
            setBadge('cciBadge', us100Ind.cci < -100, 'buy');
            setBadge('cciBadge', us100Ind.cci > 100, 'sell');
            
            setBadge('mfiBadge', us100Ind.mfi < 20, 'buy');
            setBadge('mfiBadge', us100Ind.mfi > 80, 'sell');
            
            setBadge('williamsBadge', us100Ind.williams < -80, 'buy');
            setBadge('williamsBadge', us100Ind.williams > -20, 'sell');
            
            setBadge('rocBadge', parseFloat(us100Ind.roc) > 2, 'buy');
            setBadge('rocBadge', parseFloat(us100Ind.roc) < -2, 'sell');
            
            // Analiza US100
            const analysis = analyzeAllIndicators(us100Ind, us100Price, prevUs100Price);
            const totalScore = analysis.buyScore - analysis.sellScore;
            
            document.getElementById('scoreDisplay').innerHTML = `Wynik ko≈Ñcowy: BUY ${analysis.buyScore} / SELL ${analysis.sellScore} = ${totalScore > 0 ? '+' : ''}${totalScore}`;
            
            // System potwierdze≈Ñ
            let signalType = null;
            if (totalScore > 40) signalType = 'BUY';
            else if (totalScore < -40) signalType = 'SELL';
            
            const signalBox = document.getElementById('us100Signal');
            const reasonsBox = document.getElementById('reasonsBox');
            const reasonsList = document.getElementById('reasonsList');
            
            if (signalType) {
                if (lastSignal === signalType) {
                    confirmationCount++;
                } else {
                    confirmationCount = 1;
                    lastSignal = signalType;
                }
                
                if (confirmationCount >= REQUIRED_CONFIRMATIONS) {
                    const confidence = Math.min(95, 70 + confirmationCount * 5);
                    
                    signalBox.className = `us100-signal ${signalType.toLowerCase()}`;
                    signalBox.innerHTML = `${signalType === 'BUY' ? 'üü¢' : 'üî¥'} ${signalType} (${confidence}%) | Wynik: ${totalScore}`;
                    
                    reasonsBox.style.display = 'block';
                    reasonsList.innerHTML = analysis.reasons.map(r => 
                        `<div class="reason ${r.type}">‚úì ${r.text}</div>`
                    ).join('');
                    
                    const now = Date.now();
                    if (now - lastSignalTime >= MIN_SIGNAL_INTERVAL) {
                        lastSignalTime = now;
                        signalHistory.unshift({
                            type: signalType,
                            price: us100Price.toFixed(2),
                            time: new Date().toLocaleTimeString(),
                            confidence: confidence
                        });
                        if (signalHistory.length > 10) signalHistory.pop();
                        updateSignalHistory();
                    }
                } else {
                    signalBox.className = 'us100-signal';
                    signalBox.innerHTML = `‚è≥ POTWIERDZANIE ${confirmationCount}/${REQUIRED_CONFIRMATIONS} | Wynik: ${totalScore}`;
                    reasonsBox.style.display = 'none';
                }
            } else {
                confirmationCount = 0;
                lastSignal = null;
                signalBox.className = 'us100-signal';
                signalBox.innerHTML = `‚è≥ NEUTRALNY (${analysis.buyScore}/${analysis.sellScore}) | Wynik: ${totalScore}`;
                reasonsBox.style.display = 'none';
            }
        }

        function updateSignalHistory() {
            const historyDiv = document.getElementById('signalHistory');
            if (signalHistory.length === 0) {
                historyDiv.innerHTML = '<div style="color: #6b7280; text-align: center;">Brak sygna≈Ç√≥w</div>';
                return;
            }
            historyDiv.innerHTML = signalHistory.map(s => `
                <div class="history-item ${s.type.toLowerCase()}">
                    <span class="history-time">${s.time}</span>
                    <span class="history-price">${s.price}</span>
                    <span>${s.confidence}%</span>
                    <span>${s.type === 'BUY' ? 'üü¢' : 'üî¥'}</span>
                </div>
            `).join('');
        }

        document.getElementById('instrumentSelect').addEventListener('change', (e) => {
            currentInstrument = e.target.value;
            initTradingView(currentInstrument);
        });

        setInterval(calculateIndicators, 3000);
        initTradingView('NASDAQ:NDX');
    </script>
</body>
</html>